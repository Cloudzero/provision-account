# [1.0.89](https://github.com/Cloudzero/provision-account/compare/1.0.88...1.0.89) (2025-11-06)

> Update IAM policies to latest AWS managed policies, improve CUR validation flexibility, upgrade Python runtime to 3.12, and add comprehensive permissions documentation

## New Features

### IAM Policy Updates
* **Replace SecurityAudit with ComputeOptimizerReadOnlyAccess** - Align with latest AWS Compute Optimizer features for better rightsizing recommendations
* **Add ReadOnlyOptimizationHub20251103 policy statement** - Enable access to AWS Cost Optimization Hub recommendations using correct `cost-optimization-hub:GetRecommendation` and `cost-optimization-hub:ListRecommendations` actions
* **Add CloudFormationAccess20251103 policy statement** - Comprehensive CloudFormation read permissions (Describe*, Get*, List*)
* **Remove duplicate CloudFormation actions** - Removed `cloudformation:DescribeStacks` and `cloudformation:ListStackResources` from CZActivityMonitoring20210423 statement (now covered by CloudFormationAccess20251103)

### CUR Validation Improvements
* **Implement two-tier CUR validation** - IDEAL schema (preferred) and MINIMUM schema (fallback)
* **Accept DAILY CUR reports** - In addition to preferred HOURLY reports
* **Flexible AdditionalSchemaElements** - Accept any value, prefer ['RESOURCES']
* **Flexible ReportVersioning** - Accept any value, prefer CREATE_NEW_REPORT
* **Flexible RefreshClosedReports** - Accept True or False, prefer True
* Improves compatibility with existing customer CUR configurations

### Documentation (Fixes #28)
* **Add comprehensive "AWS Permissions Explained" section to README** - Addresses 5+ year old community request
* **7-category permission breakdown** - Cost & Billing Analysis, Compute Optimization, Container Cost Tracking, Resource Discovery, Activity Monitoring, Infrastructure Configuration, Optimization Recommendations
* **Document AWS managed policies** - ComputeOptimizerReadOnlyAccess, ViewOnlyAccess, CloudWatchReadOnlyAccess, AWSBillingReadOnlyAccess
* **Explain account types** - Master Payer vs Resource Owner with clear use cases
* **Security & privacy information** - Read-only access, cross-account IAM roles, encryption, SOC 2 compliance
* **Deployment options** - CloudFormation vs Terraform comparison

## Improvements

### Python Runtime
* **Upgrade from Python 3.11 → 3.12** for all Lambda functions
  - `services/account_type/master_payer.yaml` - Inline CUR creation Lambda
  - `services/discovery/template.yaml` - Discovery service Lambda
  - `services/notification/template.yaml` - Notification service Lambda

### Code Quality
* **Fix linting issue** - Convert `not (x in y)` to `x not in y` (E713)
* **Add .venv to .gitignore** - Improve local development experience

## Files Modified

**12 files changed** (+221 insertions, -30 deletions)

### CloudFormation Templates
- `services/account_type/master_payer.yaml`
- `services/account_type/resource_owner.yaml`
- `services/discovery/template.yaml`
- `services/notification/template.yaml`

### Terraform Modules
- `terraform/cloudzero-payer/main.tf`
- `terraform/cloudzero-resource/main.tf`

### Policy Documentation
- `policies/managed.json`
- `policies/master_payer.json`
- `policies/resource_owner.json`

### Python Code
- `services/discovery/src/app.py`

### Documentation & Config
- `README.md` (+77 lines of permissions documentation)
- `.gitignore`

## Testing

✅ All tests passing (18/18)
- Discovery service: 9/9 tests passed (87.65% coverage)
- Notification service: 9/9 tests passed (87.65% coverage)

✅ Linting clean (ruff)

## Breaking Changes

**None** - All changes are backward compatible

## Deployment Notes

### CloudFormation
- Templates can be deployed immediately
- Existing stacks can be updated in place
- No manual intervention required

### Terraform
- Run `terraform plan` to review changes
- Apply will update IAM policies in place
- No resource recreation required

### Lambda Functions
- Python 3.12 runtime available in all AWS regions
- No code changes required for upgrade

## Related Issues

Closes #28 - Request for service permission documentation (opened September 23, 2019)
